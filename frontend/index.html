<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒì¼ ê°œì¸ì •ë³´ ìœ„í—˜ ì ê²€ ëŒ€ì‹œë³´ë“œ (Backend A)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #343a40;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: auto;
            background: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #007bff;
            border-bottom: 3px solid #e9ecef;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-weight: 600;
        }

        h2 {
            color: #495057;
            margin-top: 30px;
            margin-bottom: 15px;
            border-left: 5px solid #007bff;
            padding-left: 10px;
        }

        #upload-section {
            padding: 30px;
            border: 2px dashed #ced4da;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
            background-color: #f1f3f5;
        }

        #file-input {
            display: none;
        }

        #file-list-preview {
            margin-top: 15px;
            font-size: 0.95em;
            color: #6c757d;
        }

        #file-list-preview span {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            background-color: #e9ecef;
            border-radius: 5px;
        }

        .upload-button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        .upload-button:hover {
            background-color: #0056b3;
        }

        .analyze-button {
            background-color: #28a745 !important;
            margin-left: 15px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .analyze-button:hover {
            background-color: #1e7e34 !important;
        }

        .analyze-button:disabled {
            background-color: #6c757d !important;
            cursor: not-allowed;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-radius: 8px;
            overflow: hidden;
        }

        .results-table th,
        .results-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .results-table th {
            background-color: #f1f3f5;
            color: #495057;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            user-select: none;
        }

        .results-table th:hover {
            background-color: #e9ecef;
        }

        /* ì •ë ¬ í™”ì‚´í‘œ ìŠ¤íƒ€ì¼ */
        .results-table th::after {
            font-size: 0.8em;
            margin-left: 5px;
        }

        .results-table th:not(.sorted-asc):not(.sorted-desc):not(:nth-child(5)):not(:last-child)::after {
            content: ' â–²â–¼';
            color: #000000;
        }

        .results-table th.sorted-asc::after {
            content: ' â–²â–¼';
            background: linear-gradient(to right, #007bff 0%, #007bff 50%, #000000 50%, #000000 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .results-table th.sorted-desc::after {
            content: ' â–²â–¼';
            background: linear-gradient(to right, #000000 0%, #000000 50%, #007bff 50%, #007bff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .results-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .risk-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            min-width: 80px;
            text-align: center;
        }

        .high {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .medium {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .low {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .failed,
        .not-applicable {
            background-color: #e9ecef;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .score-text {
            font-weight: bold;
            font-size: 1.1em;
            color: #007bff;
        }

        .detail-link {
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s;
        }

        .detail-link:hover {
            color: #0056b3;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #ffffff;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #ccc;
            width: 90%;
            max-width: 850px;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
        }

        .alert-box {
            padding: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #ffc107;
            border-radius: 4px;
            color: #856404;
            background-color: #fff3cd;
            font-weight: 500;
            font-size: 1.05em;
        }

        .recommendation {
            display: none;
            /* BíŒŒíŠ¸ì—ì„œ í™œì„±í™” */
            background-color: #eaf5ff;
            border-left: 5px solid #007bff;
            padding: 15px;
            margin-top: 20px;
            font-weight: 500;
            border-radius: 4px;
        }

        .modal-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .modal-table th,
        .modal-table td {
            padding: 10px;
            border: 1px solid #dee2e6;
            text-align: left;
        }

        .modal-table th {
            background-color: #e9ecef;
        }

        .action-buttons {
            margin-top: 25px;
            border-top: 1px solid #e9ecef;
            padding-top: 15px;
        }

        .action-buttons button {
            margin-right: 10px;
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }

        .mask-btn {
            background-color: #ffc107;
            color: #343a40;
        }

        .feedback-btn {
            background-color: #17a2b8;
            color: white;
        }

        .request-btn {
            background-color: #6c757d;
            color: white;
        }

        #summary-panel {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            line-height: 1.6;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        #summary-panel h3 {
            color: #007bff;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 10px;
        }

        #summary-panel strong {
            font-weight: 700;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, .4);
            border-left-color: #ffffff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: none;
            margin-left: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 5px solid #f5c6cb;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ğŸ“„ íŒŒì¼ ê°œì¸ì •ë³´ ìœ„í—˜ íƒì§€ (PII Detection Engine)</h1>

        <div id="upload-section">
            <p>ì ê²€í•  íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ì„¸ìš”.</p>
            <input type="file" id="file-input" multiple onchange="previewFiles()">
            <label for="file-input" class="upload-button">íŒŒì¼ ì„ íƒ</label>
            <button class="upload-button analyze-button" id="analyze-btn" onclick="startAnalysis()">
                íŒŒì¼ ë¶„ì„ ì‹œì‘
                <div id="loading-spinner" class="spinner"></div>
            </button>
            <button class="upload-button" style="background-color: #dc3545; margin-left: 10px;"
                onclick="clearHistory()">
                ê²°ê³¼ ì´ˆê¸°í™”
            </button>
            <div id="file-list-preview">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</div>
        </div>

        <div id="error-container"></div>

        <h2>ë¶„ì„ ê²°ê³¼</h2>

        <div id="summary-panel" style="display: none;">
            <h3>ğŸš¨ íƒì§€ ê²°ê³¼ ìš”ì•½</h3>
            <p id="overall-risk-text"></p>
        </div>

        <table class="results-table">
            <thead>
                <tr>
                    <th id="col-filename" onclick="sortTable('filename')">íŒŒì¼ëª…</th>
                    <th id="col-risk" onclick="sortTable('risk')">ìœ„í—˜ ë“±ê¸‰</th>
                    <th id="col-score" onclick="sortTable('score')">ì ìˆ˜</th>
                    <th>ë°œê²¬ëœ ê°œì¸ì •ë³´ ìœ í˜• ìš”ì•½</th>
                    <th>ìƒì„¸ ë³´ê¸°</th>
                </tr>
            </thead>
            <tbody id="results-body">
                <tr>
                    <td colspan="5" style="text-align: center; color: #6c757d;">ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì„ ì„ íƒí•˜ê³  ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.</td>
                </tr>
            </tbody>
        </table>

    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3 id="modal-filename"></h3>
            <p><strong>ìµœì¢… ì ìˆ˜:</strong> <span id="modal-score" class="score-text"></span></p>
            <p><strong>ìœ„í—˜ ë“±ê¸‰:</strong> <span id="modal-risk-level" class="risk-badge"></span></p>
            <div id="modal-recommendation" class="recommendation" style="display: none;"></div>

            <div id="modal-alert-box" class="alert-box" style="display: none;"></div>

            <h4 id="findings-title">ë°œê²¬ëœ ê°œì¸ì •ë³´ ìƒì„¸ ëª©ë¡</h4>
            <table id="findings-table" class="modal-table">
                <thead>
                    <tr>
                        <th>ë°œê²¬ í•­ëª©</th>
                        <th>ì ìˆ˜</th>
                        <th>ìœ„ì¹˜</th>
                        <th>ë¯¸ë¦¬ë³´ê¸° (ë§ˆìŠ¤í‚¹)</th>
                        <th>í”¼ë“œë°±</th>
                    </tr>
                </thead>
                <tbody id="findings-body">
                </tbody>
            </table>

            <div id="modal-actions" class="action-buttons">
                <button class="mask-btn" onclick="applyMasking(currentSelectedFile)">ë§ˆìŠ¤í‚¹ ì ìš© ë¯¸ë¦¬ë³´ê¸°</button>
                <button class="request-btn" onclick="requestOriginalView(currentSelectedFile)">ì›ë³¸ ë³´ê¸° ìš”ì²­ (ê´€ë¦¬ì
                    ìŠ¹ì¸)</button>
            </div>

        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000';

        let currentData = [];
        let allAnalysisHistory = [];
        let sortDirection = 1;
        let sortColumn = null;
        let currentSelectedFile = null;

        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `<div class="error-message">âŒ ${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        function getRiskInfo(score, riskLevel) {
            if (riskLevel === "High") {
                return { label: "ğŸ”´ ìœ„í—˜", class: "high" };
            } else if (riskLevel === "Medium") {
                return { label: "ğŸŸ¡ ì£¼ì˜", class: "medium" };
            } else if (riskLevel === "Low") {
                return { label: "ğŸŸ¢ ë³´í†µ", class: "low" };
            } else {
                return { label: "âš« ë¶„ì„ ë¶ˆê°€", class: "failed" };
            }
        }

        function previewFiles() {
            const input = document.getElementById('file-input');
            const preview = document.getElementById('file-list-preview');
            preview.innerHTML = '';

            if (input.files.length === 0) {
                preview.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
                return;
            }

            const fileNames = Array.from(input.files).map(file => `<span>${file.name}</span>`);
            preview.innerHTML = fileNames.join('');
        }

        const GUIDELINE_API_URL = 'http://localhost:8000';

        async function startAnalysis() {
            const input = document.getElementById('file-input');
            const files = input.files;

            if (files.length === 0) {
                showError('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const spinner = document.getElementById('loading-spinner');
            const analyzeBtn = document.getElementById('analyze-btn');

            spinner.style.display = 'inline-block';
            analyzeBtn.disabled = true;

            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/analyze`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }

                const historyResponse = await fetch(`${GUIDELINE_API_URL}/api/history`);
                let dbData = [];
                if (historyResponse.ok) {
                    dbData = await historyResponse.json();
                } else {
                    throw new Error("ê°€ì´ë“œë¼ì¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }

                const flaskData = await response.json();

                const finalResults = flaskData.results.map((flaskItem, index) => {
                    // íŒŒì¼ëª…ì´ ê°™ì€ ë°ì´í„°ë¥¼ DBì—ì„œ ì°¾ìŒ
                    const matchedDbItem = dbData.find(dbItem => dbItem.filename === flaskItem.filename);
                    
                    return {
                        ...flaskItem,
                        id: flaskItem.id || (Date.now() + index),
                        timestamp: new Date().toLocaleString('ko-KR'),
                        // DBì— ì €ì¥ëœ ê°€ì´ë“œë¼ì¸ì´ ìˆë‹¤ë©´ ê°€ì ¸ì˜¤ê³ , ì—†ìœ¼ë©´ null
                        guideline: matchedDbItem ? matchedDbItem.guideline : null 
                    };
                });

                // const newResults = flaskData.results.map((item, index) => ({
                //     ...item,
                //     id: item.id || (Date.now() + index),
                //     timestamp: new Date().toLocaleString('ko-KR')
                // }));

                //allAnalysisHistory = [...allAnalysisHistory, ...newResults];
                allAnalysisHistory = [...allAnalysisHistory, ...finalResults];
                currentData = [...allAnalysisHistory];

                renderResults(currentData);
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                showError(`ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.`);
            } finally {
                spinner.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        }

        function renderResults(data) {
            const tbody = document.getElementById('results-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #6c757d;">ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            data.forEach((file) => {
                const row = tbody.insertRow();
                const riskInfo = getRiskInfo(file.overall_score, file.risk_level);

                let summary = file.scan_status === "ok" ?
                    `ì´ ${file.findings.length}ê±´ ë°œê²¬` :
                    `[${file.fail_reason === 'encrypted' ? 'ì•”í˜¸í™”' : 'ì†ìƒ/ë¯¸ì§€ì›'} - ìƒì„¸]`;

                row.insertCell().textContent = file.filename;
                row.insertCell().innerHTML = `<span class="risk-badge ${riskInfo.class}">${riskInfo.label}</span>`;
                row.insertCell().textContent = file.scan_status === "ok" ? file.overall_score + 'ì ' : 'N/A';
                // ë²•ì  ë¦¬ìŠ¤í¬ ì ìˆ˜ ì»¬ëŸ¼ ì œê±°ë¨
                row.insertCell().textContent = summary;
                row.insertCell().innerHTML = `<a href="#" class="detail-link" onclick="openModal(${currentData.indexOf(file)}); return false;">ìì„¸íˆ ë³´ê¸°</a>`;
            });

            updateSummaryPanel(data);
        }

        function updateSummaryPanel(data) {
            const summaryPanel = document.getElementById('summary-panel');
            const overallRiskText = document.getElementById('overall-risk-text');

            if (data.length === 0) { summaryPanel.style.display = 'none'; return; }
            summaryPanel.style.display = 'block';

            let maxScore = 0;
            let highestRiskLevel = 'Low';

            data.filter(f => f.scan_status === "ok").forEach(file => {
                if (file.overall_score > maxScore) {
                    maxScore = file.overall_score;
                    highestRiskLevel = file.risk_level;
                }
            });

            const info = getRiskInfo(maxScore, highestRiskLevel);

            if (maxScore >= 8) {
                summaryPanel.style.backgroundColor = '#f8d7da'; summaryPanel.style.border = '2px solid #f5c6cb';
                overallRiskText.innerHTML = `âš ï¸ ìµœëŒ€ ìœ„í—˜ íŒŒì¼ ë°œê²¬! ë¶„ì„ëœ íŒŒì¼ ì¤‘ ${info.label} (${maxScore}ì ) ìˆ˜ì¤€ì˜ íŒŒì¼ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`;
            } else if (maxScore >= 5) {
                summaryPanel.style.backgroundColor = '#fff3cd'; summaryPanel.style.border = '2px solid #ffeeba';
                overallRiskText.innerHTML = `ğŸŸ¡ ì£¼ì˜ íŒŒì¼ ë°œê²¬! ë¶„ì„ëœ íŒŒì¼ì€ ìµœëŒ€ ${info.label} (${maxScore}ì ) ìˆ˜ì¤€ì…ë‹ˆë‹¤.`;
            } else {
                summaryPanel.style.backgroundColor = '#d4edda'; summaryPanel.style.border = '2px solid #c3e6cb';
                overallRiskText.innerHTML = `âœ… ìœ„í—˜ë„ ë‚®ìŒ. ëŒ€ë¶€ë¶„ì˜ íŒŒì¼ì´ ì•ˆì „í•œ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            }
        }

        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection *= -1;
            } else {
                sortColumn = column;
                sortDirection = 1; // ì²« í´ë¦­ì€ ì˜¤ë¦„ì°¨ìˆœ
            }

            document.querySelectorAll('.results-table th').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });

            const currentHeader = document.getElementById(`col-${column}`);
            if (currentHeader) {
                currentHeader.classList.add(sortDirection === 1 ? 'sorted-asc' : 'sorted-desc');
            }

            currentData.sort((a, b) => {
                let valA, valB;

                if (column === 'filename') {
                    valA = a.filename.toUpperCase();
                    valB = b.filename.toUpperCase();
                    if (valA < valB) return -1 * sortDirection;
                    if (valA > valB) return 1 * sortDirection;
                    return 0;
                }
                else if (column === 'score') {
                    valA = a.overall_score;
                    valB = b.overall_score;
                    return (valB - valA) * sortDirection;
                }
                else if (column === 'risk') {
                    const rank = { "High": 3, "Medium": 2, "Low": 1, "N/A": 0 };
                    valA = rank[a.risk_level];
                    valB = rank[b.risk_level];
                    return (valB - valA) * sortDirection;
                }

                return 0;
            });

            renderResults(currentData);
        }

        function openModal(index) {
            const file = currentData[index];
            currentSelectedFile = file;
            const modal = document.getElementById('result-modal');
            const riskInfo = getRiskInfo(file.overall_score, file.risk_level);

            document.getElementById('modal-filename').textContent = file.filename;
            document.getElementById('modal-score').textContent = file.scan_status === "ok" ? file.overall_score + 'ì ' : 'N/A';
            document.getElementById('modal-risk-level').textContent = riskInfo.label;
            document.getElementById('modal-risk-level').className = 'risk-badge ' + riskInfo.class;

            document.getElementById('modal-alert-box').style.display = 'none';
            const findingsBody = document.getElementById('findings-body');
            findingsBody.innerHTML = '';
            document.getElementById('modal-actions').style.display = 'flex';

            //document.getElementById('modal-recommendation').style.display = 'none';

            const recommendationBox = document.getElementById('modal-recommendation');
            recommendationBox.style.display = 'none';

            if (file.guideline) {
                recommendationBox.innerHTML = `<strong>ğŸ’¡ ë³´ì•ˆ ê°€ì´ë“œë¼ì¸ (System Recommendation)</strong><br>${file.guideline}`;
                recommendationBox.style.display = 'block';
            }

            if (file.scan_status === "ok") {
                document.getElementById('findings-title').style.display = 'block';
                document.getElementById('findings-table').style.display = 'table';

                const sortedFindings = [...file.findings].sort((a, b) => b.score - a.score);

                sortedFindings.forEach((finding, idx) => {
                    const row = findingsBody.insertRow();
                    row.insertCell().textContent = finding.type_label;
                    row.insertCell().textContent = finding.score + 'ì ';
                    row.insertCell().textContent = finding.location;
                    row.insertCell().textContent = finding.value_preview;

                    row.insertCell().innerHTML = `
                    <button class="feedback-btn" style="background-color: #28a745;" onclick="submitFeedback(${file.id}, ${idx}, true)">ì •í™•í•¨</button>
                    <button class="feedback-btn" style="background-color: #dc3545;" onclick="submitFeedback(${file.id}, ${idx}, false)">ì˜¤íƒ</button>
                `;
                });

            } else {
                document.getElementById('findings-title').style.display = 'none';
                document.getElementById('findings-table').style.display = 'none';
                document.getElementById('modal-actions').style.display = 'none';

                let alertMessage = file.fail_reason === "encrypted" ?
                    "âš ï¸ ì´ íŒŒì¼ì€ ì•”í˜¸í™”ë˜ì–´ ìë™ ê²€ì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." :
                    "âš ï¸ í˜„ì¬ ì§€ì›í•˜ì§€ ì•ŠëŠ” í˜•ì‹(ì†ìƒ)ì´ë¼ ìë™ ê²€ì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";

                document.getElementById('modal-alert-box').innerHTML = alertMessage;
                document.getElementById('modal-alert-box').style.display = 'block';
            }

            modal.style.display = "block";
        }

        function applyMasking(file) {
            alert(`[${file.filename}] íŒŒì¼ì— ëŒ€í•´ ë§ˆìŠ¤í‚¹ ì ìš©ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.\n(ë°±ì—”ë“œ API í˜¸ì¶œ: /api/mask/preview?file_id=${file.id})`);
        }

        function submitFeedback(fileId, findingId, isCorrect) {
            const status = isCorrect ? "ì •í™•í•¨(True Positive)" : "ì˜¤íƒ(False Positive)";
            alert(`[API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜] \níŒŒì¼ ID: ${fileId}, íƒì§€ ID: ${findingId}ì— ëŒ€í•´ "${status}" í”¼ë“œë°±ì„ ì œì¶œí–ˆìŠµë‹ˆë‹¤. \n\nì´ ë°ì´í„°ëŠ” ë¶„ì„ ì—”ì§„ì˜ ì •í™•ë„ë¥¼ ë†’ì´ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.`);
        }

        function requestOriginalView(file) {
            const reason = prompt(`[${file.filename}] íŒŒì¼ì˜ ë§ˆìŠ¤í‚¹ í•´ì œ/ì›ë³¸ ë³´ê¸° ìš”ì²­ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”:`);
            if (reason) {
                alert(`[API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜] \níŒŒì¼ëª…: ${file.filename} ì›ë³¸ ë³´ê¸° ìš”ì²­ì´ ê´€ë¦¬ìì—ê²Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. \nì‚¬ìœ : "${reason}"\n\n(ì‹¤ì œ êµ¬í˜„ ì‹œ: ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì›ë³¸ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ)`);
            }
        }

        function clearHistory() {
            if (confirm('ëª¨ë“  ë¶„ì„ ê²°ê³¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                allAnalysisHistory = [];
                currentData = [];
                sortColumn = null;
                sortDirection = 1;

                document.querySelectorAll('.results-table th').forEach(th => {
                    th.classList.remove('sorted-asc', 'sorted-desc');
                });

                renderResults(currentData);

                const summaryPanel = document.getElementById('summary-panel');
                summaryPanel.style.display = 'none';
            }
        }

        const modal = document.getElementById('result-modal');
        const closeBtn = document.getElementsByClassName("close-btn")[0];
        closeBtn.onclick = function () { modal.style.display = "none"; }
        window.onclick = function (event) { if (event.target == modal) { modal.style.display = "none"; } }
    </script>

</body>

</html>